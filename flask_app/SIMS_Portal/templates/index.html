{% extends "layout.html" %}
{% block content %}
<section class="position-relative overflow-hidden">
	<div class="container pt-lg-2">
		<div class="row flex-lg-nowrap">
			<div class="col-lg-5 col-xl-5 text-center text-lg-start pt-5 mt-xl-4">
				<div class="col jumbotron">
					<h3 class='pb-3 sims-blue Montserrat'>We support operations with<br><span class="text-danger typed"> </span></h3>
					<p class="lead mt-4">{{ _('SIMS is a global network of Information Management experts who support IFRC emergency response operations by providing a variety of services and products. We maintain a roster of specialists from around the world across several key areas of technical support, including geospatial analysis, web-based and static data visualization, mobile data collection, scenario planning, and much more.') }}</p>
					<p class="lead mt-4">Remote coordinators work directly with teams in the field to translate operational needs into discrete tasks, which are then assigned to specialists with the skills and experience to complete them, all with lightning fast turnaround.</p>
					<br>
					<a href="/about" class="btn btn-danger btn-lg my-3" id="override-link-color">Learn More</a>
					
				</div>
			</div>
			<div class='col'>
				<div class='mt-6'>
					<svg viewBox="100 0 650 650" preserveAspectRatio="none"></svg>
					<script src="https://d3js.org/d3.v4.min.js"></script>
					<script src="https://d3js.org/topojson.v1.min.js"></script>
					<script>
						const width = 750;
						const height = 750;
				  		const config = {
				  		speed: 0.02,
				  		verticalTilt: -15,
				  		horizontalTilt: 0
						}
						let locations = [];
						const svg = d3.select('svg').attr('width', width).attr('height', height);
						const markerGroup = svg.append('g');
						const projection = d3.geoOrthographic();
						const initialScale = projection.scale();
						const path = d3.geoPath().projection(projection);
						const center = [width/2, height/2];
					
						drawGlobe();    
						drawGraticule();
						enableRotation();    
					
						function drawGlobe() {  
							d3.queue()
								.defer(d3.json, 'https://gist.githubusercontent.com/mbostock/4090846/raw/d534aba169207548a8a3d670c9c2cc719ff05c47/world-110m.json')          
								.defer(d3.json, '/static/data/locations.json')
								.await((error, worldData, locationData) => {
									svg.selectAll(".segment")
										.data(topojson.feature(worldData, worldData.objects.countries).features)
										.enter().append("path")
										.attr("class", "segment")
										.attr("d", path)
										.style("stroke", "#888")
										.style("stroke-width", "1px")
										.style("fill", (d, i) => '#e5e5e5')
										.style("opacity", ".6");
										locations = locationData;
										drawMarkers();                   
								});
						}
					
						function drawGraticule() {
							const graticule = d3.geoGraticule()
								.step([10, 10]);
					
							svg.append("path")
								.datum(graticule)
								.attr("class", "graticule")
								.attr("d", path)
								.style("fill", "#fff")
								.style("stroke", "#ccc");
						}
					
						function enableRotation() {
							d3.timer(function (elapsed) {
								projection.rotate([config.speed * elapsed - 10, config.verticalTilt, config.horizontalTilt]);
								svg.selectAll("path").attr("d", path);
								drawMarkers();
							});
						}        
					
						function drawMarkers() {
							const markers = markerGroup.selectAll('circle')
								.data(locations);
							markers
								.enter()
								.append('circle')
								.merge(markers)
								.attr('cx', d => projection([d.longitude, d.latitude])[0])
								.attr('cy', d => projection([d.longitude, d.latitude])[1])
								.attr('fill', d => {
									const coordinate = [d.longitude, d.latitude];
									gdistance = d3.geoDistance(coordinate, projection.invert(center));
									return gdistance > 1.8 ? 'none' : 'red';
								})
								.attr('stroke', d => {
									const coordinate = [d.longitude, d.latitude];
									gdistance = d3.geoDistance(coordinate, projection.invert(center));
									return gdistance > 1.8 ? 'none' : 'white';
								})
								.attr('r', 4);
					
							markerGroup.each(function () {
								this.parentNode.appendChild(this);
							});
						}
						svg.append("circle").attr("cx",600).attr("cy",500).attr("r", 6).style("fill", "red")
						svg.append("text").attr("x", 620).attr("y", 500).text("SIMS Member").style("font-size", "12px").attr("alignment-baseline","middle")
					</script>
				</div>
				<!-- <img src='/static/assets/img/top-banner.png' class='img-fluid mt-5' usemap="#image-map"> -->
			</div>
		</div>
	</div>
</section>
<div class="container">
	<h3 class="text-dark mt-2 Montserrat">Latest Response Stories</h3>
	<div id="carouselStories" class="carousel slide mt-4 mb-5" data-ride="carousel">
		<ol class="carousel-indicators">
			<li data-target="#carouselStories" data-slide-to="0" class="active"></li>
			<li data-target="#carouselStories" data-slide-to="1"></li>
			<li data-target="#carouselStories" data-slide-to="2"></li>
		</ol>
		<div class="carousel-inner">
			{% for story in latest_stories %}
			<div class="carousel-item drk {% if loop.index == 1 %} active{% endif %}">
				<img class="d-block w-100 rounded rounded-5" src="/static/assets/img/stories/{{story.Story.header_image}}" alt="{{story.Emergency.emergency_name}}">
				<div class="carousel-caption d-none d-md-block">
					<h3 class='carousel-title'><a href='/story/{{story.Story.emergency_id}}'>{{story.Emergency.emergency_name}}</a></h3>
				</div>
			</div>
			{% endfor %}
		</div>
		<a class="carousel-control-prev" href="#carouselStories" role="button" data-slide="prev">
		<span class="carousel-control-prev-icon" aria-hidden="true"></span>
		</a>
		<a class="carousel-control-next" href="#carouselStories" role="button" data-slide="next">
		<span class="carousel-control-next-icon" aria-hidden="true"></span>
		</a>
	</div>
	<div class='row mb-6'>
	</div>
</div>
{% endblock content %}